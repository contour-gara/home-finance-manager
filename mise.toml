[tools]
java = "corretto-21.0.8.9.1"

[env]
HOME_FINANCE_MANAGER_BOT_TOKEN = ""

[tasks.jdeps]
description = "Show module dependencies of jar"
run = """
./gradlew clean {{arg(name="module")}}:build -x test

if [ '{{flag(name='spring')}}' = 'true' ]; then
  readonly TMP_DIR="/tmp/app-jar"
  mkdir -p ${TMP_DIR}
  trap 'rm -rf ${TMP_DIR}' EXIT

  unzip -q {{arg(name="module")}}/build/libs/{{arg(name="module")}}.jar -d "${TMP_DIR}"

  jdeps \
    -classpath '${TMP_DIR}/BOOT-INF/lib/*:${TMP_DIR}/BOOT-INF/classes:${TMP_DIR}' \
    --print-module-deps \
    --ignore-missing-deps \
    --module-path ${TMP_DIR}/BOOT-INF/lib/javax.activation-api-1.2.0.jar \
    --recursive \
    --multi-release 21 \
    -quiet \
    ${TMP_DIR}/org ${TMP_DIR}/BOOT-INF/classes ${TMP_DIR}/BOOT-INF/lib/*.jar
else
  jdeps \
    --print-module-deps \
    --ignore-missing-deps \
    --recursive \
    --multi-release 21 \
    -quiet \
    {{arg(name="module")}}/build/libs/{{arg(name="module")}}.jar
fi
"""
